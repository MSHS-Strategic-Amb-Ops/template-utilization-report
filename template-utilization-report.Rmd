---
output: 
  html_document:
    toc: no
    toc_depth: 6
    toc_float:
      collapsed: yes
    fig_width: 7
    fig_height: 6
---


<style type="text/css">
div.main-container {
  max-width: 2000px;
  margin-left: 0;
  margin-right: auto;
}
</style>

<style>
.tocify {
color: black;
}
<!-- } -->
<!-- .tocify .tocify-header { -->
<!--     position: fixed; -->
<!--     <!-- top: 50px; --> -->
<!--     left: 50px; -->
<!--     width: 350px; -->
<!--     <!-- border: solid 3px black; --> -->
<!--     <!-- height: 200px; --> -->
<!--  border: none; -->
<!-- } -->
.tocify .tocify-header .active {
color: white;
background: #d80b8c;
font-weight: bold;
}
<!-- .tocify .tocify-item { -->
<!-- background: white; -->
<!-- color: black; -->
<!--  border: none; -->
<!-- } -->
</style>


<style>
  .nav-pills>li>a:hover, .nav-pills>li>a:focus, .nav-pills>li.active>a,     .nav-pills>li.active>a:hover, .nav-pills>li.active>a:focus{
     background-color: #210070;
     }
</style>

<style>
.container { width: 1800px; }
h2 {
  background-color: #dddedd;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h3 {
  background-color: #f2f2f2;
  color: black;
  text-indent: 20px;
  <!-- font-weight: bold; -->
}
h4 {
  background-color: #f2f2f2;
  color: black;
  text-indent: 20px;
  font-weight: bold;
}
</style>

<style>
.blackbox {
  padding: 1em;
  background: white;
  color: black;
  border: 2px solid #7f7f7f;
  width: 100%;
  position: center;
  align: center;
  margin: 0px auto;
}
.center {
  text-align: left;
  margin: 0px auto;
}
</style>


<!-- ```{css toc-content, echo = FALSE} -->
<!-- #TOC { -->
<!--   right: 270px; -->
<!--   margin: 20px 0px 25px 0px; -->
<!-- } -->

<!-- .main-container { -->
<!--     margin-left: 200px; -->
<!-- } -->
<!-- ``` -->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```


```{r Load Packages, echo = FALSE, warning = FALSE, message = FALSE}

# # Load packages -----------------------------------------------------------------------------------
suppressMessages({
  memory.limit(size = 8000000)
  library(readxl)
  library(writexl)
  library(plyr)
  library(dplyr)
  library(data.table)
  library(zoo)
  library(shiny)
  library(shinydashboard)
  library(shinydashboardPlus)
  library(shinyWidgets)
  library(htmlwidgets)
  library(lubridate)
  library(tcltk)
  library(tidyverse)
  library(plotly)
  library(knitr)
  library(kableExtra)
  library(leaflet)
  library(grid)
  library(gridExtra)
  library(eeptools)
  library(ggQC)
  library(zipcodeR)
  library(utils)
  library(scales)
  library(chron)
  library(bupaR)
  library(shiny)
  library(DT)
  library(DiagrammeR)
  library(shinyalert)
  library(edeaR)
  library(processmapR)
  library(processmonitR)
  library(processanimateR)
  library(tidyr)
  library(lubridate)
  library(RColorBrewer)
  library(DiagrammeR)
  library(ggplot2)
  library(leaflet)
  library(readr)
  library(highcharter)
  library(ggforce) # for 'geom_arc_bar'
  library(packcircles) # for packed circle graph
  library(viridis)
  library(ggiraph)
  library(treemapify)
  library(treemap)
  library(broom)
  library(extrafont)
  library(tis) # for US holidays
  library(vroom)
  library(sjmisc)
  library(tools)
  library(here)
  library(shinyBS)
  library(shinyscreenshot)
  library(fasttime)
  library(shinycssloaders)
  library(feather)
  # library(zipcodeR)
  library(formattable)
  library(shinyjs)
  library(janitor)
  library(patchwork)
  library(flexdashboard)
  # library(tidyverse)
  # library(viridis)
  # library(hrbrthemes)
  # library(plotly)
  # install.packages("bsts")
  library(bsts)
  library(reactable)
  # install.packages("reactablefmtr")
  library(reactablefmtr)
  library(svDialogs)
  # library(openxlsx)
  library(flextable)
  library(officedown)
  library(officer)
  library(magrittr)
  library(webshot) 
  library(png)
  library(ggh4x)
  library(RODBC)
  library(DBI)
  library(odbc)
  library(dbplyr)
  library(pool)
  library(emojifont)
  library(bizdays)
})


```


```{r Graph asthetics, echo = FALSE, warning = FALSE, message = FALSE}
### Color Functions for Graphs ============================================================

# Mount Sinai corporate colors "USE THIS TO ADD COLORS"
MountSinai_colors <- c(
  `dark purple`  = "#212070",
  `dark pink`    = "#d80b8c",
  `dark blue`    = "#00aeef",
  `dark grey`    = "#7f7f7f",
  `yellow`       = "#ffc000",
  `purple`       = "#7030a0",
  `med purple`   = "#5753d0",
  `med pink`     = "#f75dbe",
  `med blue`     = "#5cd3ff",
  `med grey`     = "#a5a7a5",
  `light purple` = "#c7c6ef",
  `light pink`   = "#fcc9e9",
  `light blue`   = "#c9f0ff",
  `light grey`   = "#dddedd"
  )

# Function to extract Mount Sinai colors as hex codes
# Use Character names of MountSinai_colors

MountSinai_cols <- function(...) {
  cols <- c(...)
  
  if (is.null(cols))
    return (MountSinai_colors)
  
  MountSinai_colors[cols]
}

# Color Function that can be used to call all colors is "MountSinai_cols()"
# Use in ggplot 

  #MountSinai_cols()       # will provide all colors and their hex codes in a table 
  #MountSinai_cols("pink") # will provide color name and the hex code for the pink color

# Create palettes 
MountSinai_palettes <- list(
  `all`   = MountSinai_cols("dark purple","dark pink","dark blue","dark grey",
                            "med purple","med pink","med blue","med grey", 
                            "light purple","light pink","light blue","light grey"),
  
  `main`  = MountSinai_cols("dark purple","dark pink","dark blue","dark grey"),
  
  `purple`  = MountSinai_cols("dark purple","med purple","light purple"),
  
  `pink`  = MountSinai_cols("dark pink","med pink","light pink"),
  
  `blue`  = MountSinai_cols("dark blue", "med blue", "light blue"),
  
  `grey`  = MountSinai_cols("dark grey", "med grey", "light grey"),
  
  `purpleGrey` = MountSinai_cols("dark purple", "dark grey"),
  
  `pinkBlue` = MountSinai_cols("dark pink", "dark blue")
  
)

# MountSinai_palettes
# Return function to interpolate a Mount Sinai color palette
# default value is the main palette, reverse = True will change the order

MountSinai_pal <- function(palette = "all", reverse = FALSE, ...) {
  pal <- MountSinai_palettes[[palette]]
  
  if (reverse) pal <- rev(pal)
  
  colorRampPalette(pal, ...)
}



# Scale Function for ggplot can be used instead of scale_color_manual
scale_color_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)
  
  if (discrete) {
    discrete_scale("colour", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_color_gradientn(colours = pal(256), ...)
  }
}

# Scale Fill for ggplot insetead of scale_fill_manual 
scale_fill_MountSinai <- function(palette = "all", discrete = TRUE, reverse = FALSE, ...) {
  pal <- MountSinai_pal(palette = palette, reverse = reverse)

  if (discrete) {
    discrete_scale("fill", paste0("MountSinai_", palette), palette = pal, ...)
  } else {
    scale_fill_gradientn(colours = pal(256), ...)
  }
}

# Use in ggplot 
  # scale_color_MountSinai("main")

```


```{r Global Functions, echo = FALSE, warning = FALSE, message = FALSE}

'%!in%' <- function(x,y)!('%in%'(x,y)) # Does not include
not_all_na <- function(x) all(!is.na(x)) # Exclude columns with All NAs

```


```{r Global Variables, echo = FALSE, warning = FALSE, message = FALSE}

report_run_date <- Sys.Date()

# start_date <- format(as.Date("2023-01-01"), "%Y-%m-%d")

end_date <- format(as.Date(Sys.Date()-1), "%Y-%m-%d") 
start_date <- paste0(format(as.Date(end_date) %m-% months(6), "%Y-%m"),"-01")



# start_date <- paste0(format(as.Date("2023-01-2023"), "%Y-%m-%d"), " 00:00:00") 
# end_date <- paste0(format(as.Date(Sys.Date()-1), "%Y-%m-%d"), " 00:00:00") 


date_1 <- paste0(format(as.Date(Sys.Date())+1, "%Y-%m-%d"), " 00:00:00")

```


```{r Data Connections, echo = FALSE, warning = FALSE, message = FALSE}

# Connection to Oracle DB ------------------------------------------------------
conn1 <- dbPool(drv = odbc(), dsn = "OAO Cloud DB SoYoun", timeout = 30)
conn2 <- dbConnect(odbc(), 
                  "Clarity_prod", 
                  uid = "kweons01" , 
                  pwd = "kweons01123$")


# Import Slot Availability Data ------------------------------------------------
slot_raw_tbl <- tbl(conn2, "Y_DM_BOOKED_FILLED_RATE")
access_raw_tbl <- tbl(conn2, "MV_DM_PATIENT_ACCESS")
availability_raw_tbl <- tbl(conn2, "V_AVAILABILITY")
block_raw_tbl <- tbl(conn2, "AVAIL_BLOCK")
block_name_tbl <- tbl(conn2, "ZC_APPT_BLOCK")
orders_raw_tbl <- tbl(conn2, "ORDER_PROC")
coverage_tbl <- tbl(conn2, "V_PAT_ENC_COVERAGE")

slot_view_tbl <- tbl(conn1, in_schema("OAO_PRODUCTION", "AMBULATORY_SLOT_TABLE_VIEW"))

```


```{r Slot Data Processing,  echo = FALSE, warning = FALSE, message = FALSE}

slot_util_month <- slot_view_tbl %>%
  filter(VISIT_PROV_STAFF_RESOURCE_C == 1) %>%
  mutate(slot_year = year(SLOT_DATE)) %>%
  filter(SLOT_DATE >= TO_DATE(start_date, "YYYY-MM-DD HH24:MI:SS")) %>%
  filter(SLOT_DATE <= TO_DATE(end_date, "YYYY-MM-DD HH24:MI:SS")) %>%
  group_by(CAMPUS, DEPT_SPECIALTY_NAME, DEPARTMENT, PROVIDER, SLOT_MONTH_YEAR, APPT_WEEK) %>%
  summarise(avail_hours = sum(AVAILABLE_HOURS),
            sched_hours = sum(SCHEDULED_HOURS),
            arrived_hours = sum(ARRIVED_HOURS)) %>%
  group_by(CAMPUS, DEPT_SPECIALTY_NAME, DEPARTMENT, PROVIDER, SLOT_MONTH_YEAR) %>%
  summarise(avail_hours = sum(avail_hours),
            avail_hours_week = mean(avail_hours),
            sched_hours = sum(sched_hours),
            arrived_hours = sum(arrived_hours)) %>%
  mutate(sched_util = sched_hours/avail_hours,
         prov_util = arrived_hours/avail_hours) %>%
  collect()


slot_util_day <- slot_view_tbl %>%
  filter(VISIT_PROV_STAFF_RESOURCE_C == 1) %>%
  mutate(slot_year = year(SLOT_DATE)) %>%
  filter(SLOT_DATE >= TO_DATE(start_date, "YYYY-MM-DD HH24:MI:SS")) %>%
  filter(SLOT_DATE <= TO_DATE(end_date, "YYYY-MM-DD HH24:MI:SS")) %>%
  group_by(CAMPUS, DEPT_SPECIALTY_NAME, DEPARTMENT, PROVIDER, SLOT_MONTH_YEAR, APPT_DAY) %>%
  summarise(avail_hours_day = sum(AVAILABLE_HOURS),
            sched_hours_day = sum(SCHEDULED_HOURS),
            arrived_hours_day = sum(ARRIVED_HOURS),
            sched_util_day = sum(SCHEDULED_HOURS)/sum(AVAILABLE_HOURS),
            prov_util_day = sum(ARRIVED_HOURS)/sum(SCHEDULED_HOURS)) %>%
  pivot_wider(names_from = APPT_DAY,
              values_from = avail_hours_day:prov_util_day) %>%
  collect()
  
  

slot_util_summary <- left_join(slot_util_month, slot_util_day)

slot_util_summary <- slot_util_summary %>%
  dplyr::select(CAMPUS, DEPT_SPECIALTY_NAME, DEPARTMENT, PROVIDER, SLOT_MONTH_YEAR,
                avail_hours, avail_hours_week, sched_hours, arrived_hours, 
                sched_util, prov_util,
                avail_hours_day_MON, avail_hours_day_TUE, avail_hours_day_WED, avail_hours_day_THU, avail_hours_day_FRI,
                avail_hours_day_SAT,
                sched_hours_day_MON, sched_hours_day_TUE, sched_hours_day_WED, sched_hours_day_THU, sched_hours_day_FRI,
                sched_hours_day_SAT,
                arrived_hours_day_MON, arrived_hours_day_TUE, arrived_hours_day_WED, arrived_hours_day_THU, arrived_hours_day_FRI,
                arrived_hours_day_SAT,
                sched_util_day_MON, sched_util_day_TUE, sched_util_day_WED, sched_util_day_THU, sched_util_day_FRI,
                sched_util_day_SAT,
                prov_util_day_MON, prov_util_day_TUE, prov_util_day_WED, prov_util_day_THU, prov_util_day_FRI,
                prov_util_day_SAT)

```


```{r Sinai Logo, echo=FALSE, out.width = '15%'}
knitr::include_graphics("Mount_Sinai_Logo_H.png")
```


# Template Utilization Report
*Report run date: `r report_run_date`*<br/>
*Report data range: Includes templates from `r start_date` to `r end_date`*<br/>
*Excludes Non-Epic Scheduling Sites: MSH-AMBULATORY CARE, NYEE*<br/>
*Includes Providers Only (Defined in EPIC as VISIT_PROV_STAFF_RESOURCE_C = 1)*<br/>
_________________________________________________________________________________________________________________________________________________________
<br/>
<br/>


## MSHS {.tabset .tabset-fade .tabset-pills}
### TEMPLATE UTILIZATION
```{r Utilization by Month Table Output, echo = FALSE, warning = FALSE, message = FALSE}


# Table Output -----------------------------------------------------------------
# htmltools::browsable(
#   tagList(
#     tags$button(
#       tagList(fontawesome::fa("download"), "Download Table"),
#       onclick = "Reactable.downloadDataCSV('util-download-table', 'Template Utilization')"
#     ),

# htmltools::browsable(
#   tagList(
#     div(tags$label("Group by", `for` = "template-util-select")),
#     tags$select(
#       id = "template-util-select",
#       onchange = "Reactable.setGroupBy('template-util-table', this.value ? [this.value] : [])",
#       tags$option("None", value = c("CAMPUS","DEPT_SPECIALTY_NAME","DEPARTMENT","PROVIDER")),
#       # tags$option("Test", value = c("Appt.Source.New","Campus.Specialty.Group")),
#       # lapply(c("Campus", "Campus.Specialty.Group", "Appt.Source.New"), tags$option)
#       lapply(c("Site","Specialty","Department","Provider"), tags$option)
#     ),
# 
#     tags$hr("aria-hidden" = "true"),

reactable(
  slot_util_summary %>%
    filter(CAMPUS %!in% c("MSH- AMBULATORY CARE", "NYEE")) %>%
    mutate(MSHS = "MSHS") %>%
    arrange(CAMPUS, DEPT_SPECIALTY_NAME, DEPARTMENT, PROVIDER, SLOT_MONTH_YEAR),
  
  elementId = "template-util-table",
  # elementId = "cars-grouping-table",
  style = list(fontFamily = 'Calibri',
                 fontSize = '14px'),
    defaultColDef = colDef(align = "left",
                           headerStyle = list(fontWeight = "Bold", fontSize = "14px"),
                           headerClass = "bar-sort-header"),
  
    highlight = TRUE,
    # filterable = TRUE,
    pagination = FALSE,
    height = 800,
    wrap = TRUE,
  searchable = TRUE,
  
  # rowStyle = function(index) {
  #           if (index %in% c(10)) {
  #             list(`border-top` = "2px solid rgb(184,184,184)",
  #                  fontWeight = "Bold")
  #           }
  #         },

  groupBy = c("MSHS", "CAMPUS", "DEPT_SPECIALTY_NAME", "DEPARTMENT", "PROVIDER", "SLOT_MONTH_YEAR"),

  columnGroups = list(
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " Visit Volume"), 
    #          columns = c("Total", "new_perc"),
    #          headerStyle = list(color = "#212070", fontSize = "16px")),
    # colGroup(name = paste0(format(as.Date(start_date), "%b"),"-",format(as.Date(end_date), "%b %Y"), " No Show Rate"), 
    #          columns = c("noShow_rate", "noShow_rate_Established", "noShow_rate_New"),
    #          headerStyle = list(color = "#d80b8c", fontSize = "16px"))
    colGroup(name = "", 
             columns = c("MSHS", "CAMPUS", "DEPT_SPECIALTY_NAME", "DEPARTMENT", "PROVIDER", "SLOT_MONTH_YEAR"), sticky = "left", 
             headerStyle = list(fontSize = "16px")),
    colGroup(name = "Available Hours", 
             columns = c("avail_hours","avail_hours_week"),
             headerStyle = list(color = "#7f7f7f", fontSize = "16px")),
    colGroup(name = "Overall Utilization", 
             columns = c("sched_util","prov_util"),
             headerStyle = list(color = "#212070", fontSize = "16px")),
    colGroup(name = "Schedule Utiliation by Day", 
             columns = c("sched_util_day_MON", "sched_util_day_TUE", "sched_util_day_WED", "sched_util_day_THU", "sched_util_day_FRI",
                         "sched_util_day_SAT"),
             headerStyle = list(color = "#d80b8c", fontSize = "16px")),
    colGroup(name = "Provider Utiliation by Day", 
             columns = c("prov_util_day_MON", "prov_util_day_TUE", "prov_util_day_WED", "prov_util_day_THU", "prov_util_day_FRI",
                         "prov_util_day_SAT"),
             headerStyle = list(color = "#00aeef", fontSize = "16px"))
    ),

  columns = list(

    MSHS = colDef(
      # footer = "Total",
      minWidth = 140),
    
    CAMPUS = colDef(
      # footer = "Total",
      name = "Site",
      minWidth = 140),

    DEPT_SPECIALTY_NAME = colDef(
      name = "Specialty",
      minWidth = 180),
    
    DEPARTMENT = colDef(
      name = "Department",
      minWidth = 240),
    
    PROVIDER = colDef(
      name = "Provider",
      minWidth = 200),
    
    SLOT_MONTH_YEAR = colDef(
      name = "Month",
      minWidth = 110),
    
    avail_hours = colDef(
      name = "Available Hours",
      maxWidth = 130,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'sum',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    avail_hours_week = colDef(
      name = "Available Hours per Week",
      maxWidth = 130,
      headerStyle = list(background = "#7f7f7f", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = 'mean',
      format = colFormat(separators = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util = colDef(
      name = "Schedule Utilization",
      maxWidth = 130,
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours = 0
        let totalsched_hours = 0
        rows.forEach(function(row) {
          totalavail_hours += row['avail_hours']
          totalsched_hours += row['sched_hours']
        })
        return (totalsched_hours) / totalavail_hours || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),
    
    prov_util = colDef(
      name = "Provider Utilization",
      maxWidth = 130,
      headerStyle = list(background = "#212070", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours = 0
        let totalarrived_hours = 0
        rows.forEach(function(row) {
          totalavail_hours += row['avail_hours']
          totalarrived_hours += row['arrived_hours']
        })
        return (totalarrived_hours) / totalavail_hours || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util_day_MON = colDef(
      name = "Mon",
      maxWidth = 60,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_MON = 0
        let totalsched_hours_day_MON = 0
        rows.forEach(function(row) {
          totalavail_hours_day_MON += row['avail_hours_day_MON']
          totalsched_hours_day_MON += row['sched_hours_day_MON']
        })
        return (totalsched_hours_day_MON) / totalavail_hours_day_MON || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util_day_TUE = colDef(
      name = "Tue",
      maxWidth = 60,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_TUE = 0
        let totalsched_hours_day_TUE = 0
        rows.forEach(function(row) {
          totalavail_hours_day_TUE += row['avail_hours_day_TUE']
          totalsched_hours_day_TUE += row['sched_hours_day_TUE']
        })
        return (totalsched_hours_day_TUE) / totalavail_hours_day_TUE || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util_day_WED = colDef(
      name = "Wed",
      maxWidth = 60,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_WED = 0
        let totalsched_hours_day_WED = 0
        rows.forEach(function(row) {
          totalavail_hours_day_WED += row['avail_hours_day_WED']
          totalsched_hours_day_WED += row['sched_hours_day_WED']
        })
        return (totalsched_hours_day_WED) / totalavail_hours_day_WED || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util_day_THU = colDef(
      name = "Thu",
      maxWidth = 60,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_THU = 0
        let totalsched_hours_day_THU = 0
        rows.forEach(function(row) {
          totalavail_hours_day_THU += row['avail_hours_day_THU']
          totalsched_hours_day_THU += row['sched_hours_day_THU']
        })
        return (totalsched_hours_day_THU) / totalavail_hours_day_THU || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util_day_FRI = colDef(
      name = "Fri",
      maxWidth = 60,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_FRI = 0
        let totalsched_hours_day_FRI = 0
        rows.forEach(function(row) {
          totalavail_hours_day_FRI += row['avail_hours_day_FRI']
          totalsched_hours_day_FRI += row['sched_hours_day_FRI']
        })
        return (totalsched_hours_day_FRI) / totalavail_hours_day_FRI || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_util_day_SAT = colDef(
      name = "Sat",
      maxWidth = 60,
      headerStyle = list(background = "#d80b8c", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_SAT = 0
        let totalsched_hours_day_SAT = 0
        rows.forEach(function(row) {
          totalavail_hours_day_SAT += row['avail_hours_day_SAT']
          totalsched_hours_day_SAT += row['sched_hours_day_SAT']
        })
        return (totalsched_hours_day_SAT) / totalavail_hours_day_SAT || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    prov_util_day_MON = colDef(
      name = "Mon",
      maxWidth = 60,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_MON = 0
        let totalarrived_hours_day_MON = 0
        rows.forEach(function(row) {
          totalavail_hours_day_MON += row['avail_hours_day_MON']
          totalarrived_hours_day_MON += row['arrived_hours_day_MON']
        })
        return (totalarrived_hours_day_MON) / totalavail_hours_day_MON || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    prov_util_day_TUE = colDef(
      name = "Tue",
      maxWidth = 60,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_TUE = 0
        let totalarrived_hours_day_TUE = 0
        rows.forEach(function(row) {
          totalavail_hours_day_TUE += row['avail_hours_day_TUE']
          totalarrived_hours_day_TUE += row['arrived_hours_day_TUE']
        })
        return (totalarrived_hours_day_TUE) / totalavail_hours_day_TUE || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    prov_util_day_WED = colDef(
      name = "Wed",
      maxWidth = 60,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_WED = 0
        let totalarrived_hours_day_WED = 0
        rows.forEach(function(row) {
          totalavail_hours_day_WED += row['avail_hours_day_WED']
          totalarrived_hours_day_WED += row['arrived_hours_day_WED']
        })
        return (totalarrived_hours_day_WED) / totalavail_hours_day_WED || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    prov_util_day_THU = colDef(
      name = "Thu",
      maxWidth = 60,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_THU = 0
        let totalarrived_hours_day_THU = 0
        rows.forEach(function(row) {
          totalavail_hours_day_THU += row['avail_hours_day_THU']
          totalarrived_hours_day_THU += row['arrived_hours_day_THU']
        })
        return (totalarrived_hours_day_THU) / totalavail_hours_day_THU || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    prov_util_day_FRI = colDef(
      name = "Fri",
      maxWidth = 60,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_FRI = 0
        let totalarrived_hours_day_FRI = 0
        rows.forEach(function(row) {
          totalavail_hours_day_FRI += row['avail_hours_day_FRI']
          totalarrived_hours_day_FRI += row['arrived_hours_day_FRI']
        })
        return (totalarrived_hours_day_FRI) / totalavail_hours_day_FRI || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    prov_util_day_SAT = colDef(
      name = "Sat",
      maxWidth = 60,
      headerStyle = list(background = "#00aeef", color = "white", fontWeight = "Bold", fontSize = "14px"),
      aggregate = JS("function(values, rows) {
        let totalavail_hours_day_SAT = 0
        let totalarrived_hours_day_SAT = 0
        rows.forEach(function(row) {
          totalavail_hours_day_SAT += row['avail_hours_day_SAT']
          totalarrived_hours_day_SAT += row['arrived_hours_day_SAT']
        })
        return (totalarrived_hours_day_SAT) / totalavail_hours_day_SAT || '-'
      }"),
      format = colFormat(percent = TRUE, digits = 0),
      style = list(borderLeft = "1.5px solid rgb(230, 230, 230)")
    ),

    sched_hours = colDef(show =F),
    arrived_hours = colDef(show =F),
    avail_hours_day_MON = colDef(show =F),
    avail_hours_day_TUE = colDef(show =F),
    avail_hours_day_WED = colDef(show =F),
    avail_hours_day_THU = colDef(show =F),
    avail_hours_day_FRI = colDef(show =F),
    avail_hours_day_SAT = colDef(show =F),
    sched_hours_day_MON = colDef(show =F),
    sched_hours_day_TUE = colDef(show =F),
    sched_hours_day_WED = colDef(show =F),
    sched_hours_day_THU = colDef(show =F),
    sched_hours_day_FRI = colDef(show =F),
    sched_hours_day_SAT = colDef(show =F),
    arrived_hours_day_MON = colDef(show =F),
    arrived_hours_day_TUE = colDef(show =F),
    arrived_hours_day_WED = colDef(show =F),
    arrived_hours_day_THU = colDef(show =F),
    arrived_hours_day_FRI = colDef(show =F),
    arrived_hours_day_SAT = colDef(show =F)
   
  ) # Close Columns

  ) # Close Reactable

#  ) # Close tagList
# ) # Close htmltools


```
<br/>
<br/>
<br/>
